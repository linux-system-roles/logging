---
- block:
    - name: Add tcp ports to logging_firewall_ports
      set_fact:
        logging_firewall_ports: "{{ logging_firewall_ports | d([]) |
          union([{'port': item, 'state': _state_value}]) }}"
      loop: "{{ (logging_tcp_ports + logging_tls_tcp_ports) |
                map('regex_replace', '$', '/tcp') | list }}"
      when: (logging_tcp_ports + logging_tls_tcp_ports) | length > 0

    - name: Add udp ports to logging_firewall_ports
      set_fact:
        logging_firewall_ports: "{{ logging_firewall_ports | d([]) |
          union([{'port': item, 'state': _state_value}]) }}"
      loop: "{{ (logging_udp_ports + logging_tls_udp_ports) |
                map('regex_replace', '$', '/udp') | list }}"
      when: (logging_tcp_ports + logging_tls_tcp_ports) | length > 0

    - name: Manage firewall for specified ports
      include_role:
        name: fedora.linux_system_roles.firewall
      vars:
        firewall: "{{ logging_firewall_ports }}"
      when:
        - logging_firewall_ports | d([])
  vars:
    _state_value: "{{ logging_manage_firewall |
                      ternary('enabled', 'disabled') }}"
  when:
    - logging_tcp_ports or logging_udp_ports or
      logging_tls_tcp_ports or logging_tls_udp_ports
