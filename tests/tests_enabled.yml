- name: Ensure that the role runs with logging_enabled=true
  hosts: all
  become: true

  tasks:
    - name: default run
      include_role:
        name: linux-system-roles.logging

    - include_tasks: set_rsyslog_variables.yml

    - name: Check rsyslog.conf size
      assert:
        that: rsyslog_conf_stat.stat.size > 2000

    - name: Check file counts in rsyslog.d
      assert:
        that: rsyslog_d_file_count.matched < 3

    # Checking 'error' in stdout from systemctl status is for detecting the case in which rsyslog is running,
    # but some functionality is disabled due to some error, e.g., error: 'tls.cacert' file couldn't be accessed.
    - name: Check rsyslog errors
      command: systemctl status rsyslog
      register: systemctl_result
      failed_when: "'error' in systemctl_result.stdout or systemctl_result.rc != 0"
